// <auto-generated>
//     This code was generated by the BoundedContext Code Generator.
//     Generation Stamp: 20260214-d9c2f1c6
//     Generated: 2026-02-14 16:11:52 UTC
//     Source: simple-bounded-context.json
//
//     Changes to this file will be lost when regenerated.
//     Override methods in partial class for custom projection logic.
// </auto-generated>

using System.Linq.Expressions;
using Inventorization.Base.Abstractions;
using Inventorization.Base.ADTs;
using Inventorization.Commerce.Domain.Entities;
using Inventorization.Commerce.DTO.ADTs;

namespace Inventorization.Commerce.Domain.Mappers.Projection;

/// <summary>
/// Projection mapper for Customer entity.
/// Implements template methods for EF Core expressions and in-memory mapping.
/// </summary>
public class CustomerProjectionMapper : ProjectionMapperBase<Customer, CustomerProjection>, ICustomerProjectionMapper
{

    protected override Expression<Func<Customer, CustomerProjection>> GetAllFieldsProjection(bool deep, int depth)
    {
        return entity => new CustomerProjection
        {
            FirstName = entity.FirstName,
            LastName = entity.LastName,
            Email = entity.Email,
            Phone = entity.Phone,
            IsActive = entity.IsActive,
        };
    }

    protected override Expression<Func<Customer, CustomerProjection>> BuildSelectiveProjection(
        ProjectionRequest projection)
    {
        // Evaluate field checks OUTSIDE expression tree for EF Core compatibility
        var requestedFields = new HashSet<string>(
            projection.Fields.Select(f => f.FieldName),
            StringComparer.OrdinalIgnoreCase);

        var hasFirstName = requestedFields.Contains("FirstName");
        var hasLastName = requestedFields.Contains("LastName");
        var hasEmail = requestedFields.Contains("Email");
        var hasPhone = requestedFields.Contains("Phone");
        var hasIsActive = requestedFields.Contains("IsActive");

        // Use boolean constants in expression tree
        return entity => new CustomerProjection
        {
            FirstName = hasFirstName ? entity.FirstName : null,
            LastName = hasLastName ? entity.LastName : null,
            Email = hasEmail ? entity.Email : null,
            Phone = hasPhone ? entity.Phone : null,
            IsActive = hasIsActive ? entity.IsActive : null,
        };
    }

    protected override void MapAllFields(
        Customer entity,
        CustomerProjection result,
        bool deep,
        int maxDepth,
        int currentDepth)
    {
        // Map all scalar properties
        result.FirstName = entity.FirstName;
        result.LastName = entity.LastName;
        result.Email = entity.Email;
        result.Phone = entity.Phone;
        result.IsActive = entity.IsActive;

    }

    protected override void MapField(
        Customer entity,
        CustomerProjection result,
        FieldProjection field,
        int currentDepth)
    {
        var fieldName = field.FieldName.ToLower();
        
        switch (fieldName)
        {
            case "firstName":
                result.FirstName = entity.FirstName;
                break;
            case "lastName":
                result.LastName = entity.LastName;
                break;
            case "email":
                result.Email = entity.Email;
                break;
            case "phone":
                result.Phone = entity.Phone;
                break;
            case "isActive":
                result.IsActive = entity.IsActive;
                break;
        }
    }
}
