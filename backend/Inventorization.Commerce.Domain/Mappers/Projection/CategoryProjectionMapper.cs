// <auto-generated>
//     This code was generated by the BoundedContext Code Generator.
//     Generation Stamp: 20260215-38d150ed
//     Generated: 2026-02-15 09:53:00 UTC
//     Source: simple-bounded-context.json
//
//     Changes to this file will be lost when regenerated.
//     Override methods in partial class for custom projection logic.
// </auto-generated>

using System.Linq.Expressions;
using Inventorization.Base.Abstractions;
using Inventorization.Base.ADTs;
using Inventorization.Commerce.Domain.Entities;
using Inventorization.Commerce.DTO.ADTs;

namespace Inventorization.Commerce.Domain.Mappers.Projection;

/// <summary>
/// Projection mapper for Category entity.
/// Implements template methods for EF Core expressions and in-memory mapping.
/// </summary>
public class CategoryProjectionMapper : ProjectionMapperBase<Category, CategoryProjection>, ICategoryProjectionMapper
{

    protected override Expression<Func<Category, CategoryProjection>> GetAllFieldsProjection(bool deep, int depth)
    {
        return entity => new CategoryProjection
        {
            Name = entity.Name,
            Description = entity.Description,
            IsActive = entity.IsActive,
        };
    }

    protected override Expression<Func<Category, CategoryProjection>> BuildSelectiveProjection(
        ProjectionRequest projection)
    {
        // Evaluate field checks OUTSIDE expression tree for EF Core compatibility
        var requestedFields = new HashSet<string>(
            projection.Fields.Select(f => f.FieldName),
            StringComparer.OrdinalIgnoreCase);

        var hasName = requestedFields.Contains("Name");
        var hasDescription = requestedFields.Contains("Description");
        var hasIsActive = requestedFields.Contains("IsActive");

        // Use boolean constants in expression tree
        return entity => new CategoryProjection
        {
            Name = hasName ? entity.Name : null,
            Description = hasDescription ? entity.Description : null,
            IsActive = hasIsActive ? entity.IsActive : null,
        };
    }

    protected override void MapAllFields(
        Category entity,
        CategoryProjection result,
        bool deep,
        int maxDepth,
        int currentDepth)
    {
        // Map all scalar properties
        result.Name = entity.Name;
        result.Description = entity.Description;
        result.IsActive = entity.IsActive;

    }

    protected override void MapField(
        Category entity,
        CategoryProjection result,
        FieldProjection field,
        int currentDepth)
    {
        var fieldName = field.FieldName.ToLower();
        
        switch (fieldName)
        {
            case "name":
                result.Name = entity.Name;
                break;
            case "description":
                result.Description = entity.Description;
                break;
            case "isActive":
                result.IsActive = entity.IsActive;
                break;
        }
    }
}
