{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://inventorization.com/schemas/data-model.schema.json",
  "title": "BoundedContext Data Model",
  "description": "Schema for defining a complete BoundedContext data model for code generation",
  "type": "object",
  "required": ["boundedContext", "entities"],
  "properties": {
    "boundedContext": {
      "type": "object",
      "required": ["name", "namespace"],
      "properties": {
        "name": {
          "type": "string",
          "description": "BoundedContext name (e.g., 'Products', 'Auth', 'Orders')",
          "pattern": "^[A-Z][a-zA-Z0-9]*$"
        },
        "namespace": {
          "type": "string",
          "description": "Root namespace (e.g., 'Inventorization.Products')",
          "pattern": "^[A-Z][a-zA-Z0-9]*(\\.[A-Z][a-zA-Z0-9]*)*$"
        },
        "description": {
          "type": "string",
          "description": "Description of the bounded context"
        },
        "databaseName": {
          "type": "string",
          "description": "PostgreSQL database name (defaults to lowercase context name)"
        },
        "apiPort": {
          "type": "integer",
          "description": "API port number (e.g., 5022)",
          "minimum": 1024,
          "maximum": 65535
        },
        "dtoLayout": {
          "type": "string",
          "description": "DTO generation layout strategy",
          "enum": ["class", "record"],
          "default": "class"
        }
      }
    },
    "enums": {
      "type": "array",
      "description": "Enum definitions for the Common project",
      "items": {
        "type": "object",
        "required": ["name", "values"],
        "properties": {
          "name": {
            "type": "string",
            "pattern": "^[A-Z][a-zA-Z0-9]*$"
          },
          "description": {
            "type": "string"
          },
          "values": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["name"],
              "properties": {
                "name": {
                  "type": "string",
                  "pattern": "^[A-Z][a-zA-Z0-9]*$"
                },
                "value": {
                  "type": "integer"
                },
                "description": {
                  "type": "string"
                }
              }
            },
            "minItems": 1
          }
        }
      }
    },
    "entities": {
      "type": "array",
      "description": "Entity definitions",
      "items": {
        "$ref": "#/definitions/Entity"
      },
      "minItems": 1
    },
    "relationships": {
      "type": "array",
      "description": "Relationship definitions between entities",
      "items": {
        "$ref": "#/definitions/Relationship"
      }
    }
  },
  "definitions": {
    "Entity": {
      "type": "object",
      "required": ["name", "properties"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Entity name (PascalCase)",
          "pattern": "^[A-Z][a-zA-Z0-9]*$"
        },
        "tableName": {
          "type": "string",
          "description": "Database table name (defaults to entity name pluralized)"
        },
        "schema": {
          "type": "string",
          "description": "Database schema (defaults to null/public)"
        },
        "description": {
          "type": "string",
          "description": "Entity description for documentation"
        },
        "isJunction": {
          "type": "boolean",
          "description": "Whether this is a junction entity for many-to-many relationships",
          "default": false
        },
        "junctionMetadata": {
          "type": "object",
          "description": "If isJunction=true, defines the two entities being joined",
          "required": ["leftEntity", "rightEntity"],
          "properties": {
            "leftEntity": {
              "type": "string",
              "description": "Name of the first entity"
            },
            "rightEntity": {
              "type": "string",
              "description": "Name of the second entity"
            },
            "tier": {
              "type": "integer",
              "description": "Relationship tier (1 = simple junction, 3 = junction with metadata)",
              "enum": [1, 3],
              "default": 1
            }
          }
        },
        "auditable": {
          "type": "boolean",
          "description": "Whether to include audit fields (CreatedAt, UpdatedAt, etc.)",
          "default": true
        },
        "properties": {
          "type": "array",
          "description": "Entity properties",
          "items": {
            "$ref": "#/definitions/Property"
          },
          "minItems": 1
        },
        "indexes": {
          "type": "array",
          "description": "Database indexes",
          "items": {
            "type": "object",
            "required": ["columns"],
            "properties": {
              "columns": {
                "type": "array",
                "items": { "type": "string" },
                "minItems": 1
              },
              "isUnique": {
                "type": "boolean",
                "default": false
              },
              "name": {
                "type": "string"
              }
            }
          }
        }
      }
    },
    "Property": {
      "type": "object",
      "required": ["name", "type"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Property name (PascalCase)",
          "pattern": "^[A-Z][a-zA-Z0-9]*$"
        },
        "type": {
          "type": "string",
          "description": "C# type name",
          "enum": [
            "string",
            "int",
            "long",
            "decimal",
            "double",
            "float",
            "bool",
            "DateTime",
            "DateTimeOffset",
            "Guid",
            "byte[]"
          ]
        },
        "enumType": {
          "type": "string",
          "description": "If type is an enum, specify the enum name from enums array"
        },
        "required": {
          "type": "boolean",
          "description": "Whether the property is required (non-nullable)",
          "default": true
        },
        "maxLength": {
          "type": "integer",
          "description": "Maximum length for string properties",
          "minimum": 1
        },
        "minLength": {
          "type": "integer",
          "description": "Minimum length for string properties",
          "minimum": 0
        },
        "precision": {
          "type": "integer",
          "description": "Total precision for decimal properties",
          "minimum": 1,
          "maximum": 38
        },
        "scale": {
          "type": "integer",
          "description": "Scale (decimal places) for decimal properties",
          "minimum": 0
        },
        "defaultValue": {
          "description": "Default value for the property (as string)"
        },
        "description": {
          "type": "string",
          "description": "Property description for documentation"
        },
        "displayName": {
          "type": "string",
          "description": "Human-readable display name"
        },
        "validationMessage": {
          "type": "string",
          "description": "Custom validation error message"
        },
        "isForeignKey": {
          "type": "boolean",
          "description": "Whether this is a foreign key property",
          "default": false
        },
        "referencedEntity": {
          "type": "string",
          "description": "If isForeignKey=true, the referenced entity name"
        },
        "navigationProperty": {
          "type": "string",
          "description": "Name of the navigation property for this FK"
        },
        "isCollection": {
          "type": "boolean",
          "description": "Whether this is a collection navigation property",
          "default": false
        },
        "collectionType": {
          "type": "string",
          "description": "If isCollection=true, the type of items in collection"
        },
        "includeInDto": {
          "type": "object",
          "description": "Control which DTOs include this property",
          "properties": {
            "create": { "type": "boolean", "default": true },
            "update": { "type": "boolean", "default": true },
            "details": { "type": "boolean", "default": true },
            "search": { "type": "boolean", "default": false }
          }
        },
        "validation": {
          "type": "object",
          "description": "Additional validation rules",
          "properties": {
            "regex": {
              "type": "string",
              "description": "Regular expression pattern"
            },
            "customValidator": {
              "type": "string",
              "description": "Name of custom validator method to generate"
            },
            "allowedValues": {
              "type": "array",
              "description": "List of allowed values"
            },
            "min": {
              "type": "number",
              "description": "Minimum value for numeric types"
            },
            "max": {
              "type": "number",
              "description": "Maximum value for numeric types"
            }
          }
        }
      }
    },
    "Relationship": {
      "type": "object",
      "required": ["type", "leftEntity", "rightEntity"],
      "properties": {
        "type": {
          "type": "string",
          "description": "Relationship type",
          "enum": ["OneToOne", "OneToMany", "ManyToOne", "ManyToMany"]
        },
        "leftEntity": {
          "type": "string",
          "description": "Left/source entity name"
        },
        "rightEntity": {
          "type": "string",
          "description": "Right/target entity name"
        },
        "junctionEntity": {
          "type": "string",
          "description": "For ManyToMany, the junction entity name (must exist in entities)"
        },
        "cardinality": {
          "type": "string",
          "description": "Cardinality constraint",
          "enum": ["Required", "Optional"],
          "default": "Optional"
        },
        "leftNavigationProperty": {
          "type": "string",
          "description": "Navigation property name on left entity"
        },
        "rightNavigationProperty": {
          "type": "string",
          "description": "Navigation property name on right entity"
        },
        "foreignKeyProperty": {
          "type": "string",
          "description": "Foreign key property name (for OneToMany/ManyToOne)"
        },
        "onDelete": {
          "type": "string",
          "description": "Delete behavior",
          "enum": ["Cascade", "Restrict", "SetNull", "NoAction"],
          "default": "Restrict"
        },
        "displayName": {
          "type": "string",
          "description": "Human-readable relationship name"
        },
        "description": {
          "type": "string",
          "description": "Relationship description"
        }
      }
    }
  }
}
