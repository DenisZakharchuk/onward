// <auto-generated>
//     This code was generated by the BoundedContext Code Generator.
//     Generation Stamp: {{generationStamp}}
//     Generated: {{generatedAt}}
//     Source: {{sourceFile}}
// </auto-generated>

using {{baseNamespace}}.Base.Abstractions;
using {{baseNamespace}}.Base.DataAccess;
using {{baseNamespace}}.Base.Services;
using {{namespace}}.Domain.Entities;
using {{namespace}}.Domain.Creators;
using {{namespace}}.Domain.DataAccess;
using {{namespace}}.Domain.DataServices;
using {{namespace}}.Domain.DbContexts;
using {{namespace}}.Domain.Mappers;
using {{namespace}}.Domain.Mappers.Projection;
using {{namespace}}.Domain.Modifiers;
using {{namespace}}.Domain.SearchProviders;
using {{namespace}}.Domain.Services;
using {{namespace}}.Domain.Validators;
using {{namespace}}.DTO.ADTs;
{{#each entities}}
using {{../namespace}}.DTO.{{entityName}};
{{/each}}
using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.DependencyInjection;

namespace {{namespace}}.DI;

public static class {{contextName}}ServiceCollectionExtensions
{
    public static IServiceCollection Add{{contextName}}Services(
        this IServiceCollection services,
        Action<DbContextOptionsBuilder> configureDbContext)
    {
        services.AddDbContext<{{contextName}}DbContext>(configureDbContext);
        services.AddScoped<DbContext>(sp => sp.GetRequiredService<{{contextName}}DbContext>());
        services.AddScoped(typeof(IRepository<>), typeof(BaseRepository<>));
        services.AddScoped<I{{contextName}}UnitOfWork, {{contextName}}UnitOfWork>();
        services.AddScoped<IUnitOfWork>(sp => sp.GetRequiredService<I{{contextName}}UnitOfWork>());

        services.AddScoped<ProjectionExpressionBuilder>();

        {{#each entities}}
        // {{entityName}}
        services.AddScoped<IMapper<{{entityName}}, {{detailsDtoName}}>, {{mapperName}}>();
        services.AddScoped<IEntityCreator<{{entityName}}, {{createDtoName}}>, {{creatorName}}>();
        services.AddScoped<IEntityModifier<{{entityName}}, {{updateDtoName}}>, {{modifierName}}>();
        services.AddScoped<ISearchQueryProvider<{{entityName}}, {{searchDtoName}}>, {{searchProviderName}}>();
        services.AddScoped<IValidator<{{createDtoName}}>, {{createValidatorName}}>();
        services.AddScoped<IValidator<{{updateDtoName}}>, {{updateValidatorName}}>();
        services.AddScoped<IQueryBuilder<{{entityName}}>, {{queryBuilderName}}>();
        services.AddScoped<IProjectionMapper<{{entityName}}, {{projectionName}}>, {{projectionMapperName}}>();
        services.AddScoped<I{{entityName}}ProjectionMapper, {{projectionMapperName}}>();
        services.AddScoped<{{searchQueryValidatorName}}>();
        services.AddScoped<{{searchServiceName}}>(sp => new {{searchServiceName}}(
            sp.GetRequiredService<IRepository<{{entityName}}>>(),
            sp.GetRequiredService<IQueryBuilder<{{entityName}}>>(),
            sp.GetRequiredService<IProjectionMapper<{{entityName}}, {{projectionName}}>>(),
            sp.GetRequiredService<ProjectionExpressionBuilder>(),
            sp.GetRequiredService<{{searchQueryValidatorName}}>(),
            sp.GetRequiredService<Microsoft.Extensions.Logging.ILogger<{{searchServiceName}}>>()
        ));
        services.AddScoped<ISearchService<{{entityName}}, {{projectionName}}>>(
            sp => sp.GetRequiredService<{{searchServiceName}}>());
        services.AddScoped<{{dataServiceInterfaceName}}, {{dataServiceName}}>();

        {{/each}}
        return services;
    }
}
